# 职工组评分标准（总分100分）

## Task 1: 图像预处理 (20分)

### TODO 1: 导入Python库 (2分)
**位置**: 第6-7行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `import ...... as np` | `numpy` | 1分 | 完全正确1分；写`np`不给分 |
| `import ...... as plt` | `matplotlib.pyplot` | 1分 | 完全正确1分；写`matplotlib`给0.5分 |

---

### TODO 2: 图像去噪 - 绘制原图直方图 (3分)
**位置**: 第31-34行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `plt.hist(......, ......, ......)` 第1个空 | `gray_img.ravel()` | 1分 | `gray_img.ravel()`或`gray_img.flatten()`均给1分；只写变量名`gray_img`给0.5分 |
| `plt.hist(......, ......, ......)` 第2个空 | `256` | 0.5分 | 正确给0.5分；其他合理区间值（如128-512）给0.3分 |
| `plt.hist(......, ......, ......)` 第3个空 | `(0, 256)` | 0.5分 | 正确给0.5分；`[0, 256]`也给0.5分 |
| `plt.savefig(...)` | `f"{save_prefix}_hist_before.png"` | 1分 | 使用f-string且文件名包含`_hist_before.png`给1分；使用字符串拼接给0.8分；只有文件名但缺少变量给0.3分 |

---

### TODO 3: 图像去噪 - 双边滤波 (2分)
**位置**: 第38行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `denoised = cv2.......` | `bilateralFilter(gray_img, 9, 75, 75)` | 2分 | 完全正确给2分；函数名正确但参数不同（如`d=5`）给1.5分；使用其他去噪方法（如`fastNlMeansDenoising`）给1分 |

---

### TODO 4: 图像滤波 - 均值滤波 (2分)
**位置**: 第48行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `img_gray_f = cv2.......` | `blur(img_gray, (3, 3))` | 2分 | 完全正确给2分；函数名正确但核大小不同给1.5分；使用其他滤波方法（如`GaussianBlur`）给1分 |

---

### TODO 5: 图像分辨率统一 (2分)
**位置**: 第58行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `cv2.resize(......, ......)` 第1个空 | `img` | 1分 | 正确给1分 |
| `cv2.resize(......, ......)` 第2个空 | `IMG_SIZE` | 1分 | `IMG_SIZE`或`(96, 96)`均给1分 |

---

### TODO 6: 图像增强 - 形态学开运算 (3分)
**位置**: 第66行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `gray = cv2.......` | `morphologyEx(gray, cv2.MORPH_OPEN, kernel)` | 3分 | 完全正确给3分；函数名正确但操作类型错误（如`MORPH_CLOSE`）给2分；缺少kernel参数给2分 |

---

### TODO 7: 数据增强 - 旋转操作 (6分)
**位置**: 第72-75行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `rotation_matrix = cv2.......` | `getRotationMatrix2D(center, 15, 1.0)` | 2分 | 完全正确给2分；函数名正确但角度不是15度给1.5分；缺少缩放参数给1.5分 |
| `rotated = cv2.......` | `warpAffine(denoised, rotation_matrix, (w, h))` | 2分 | 完全正确给2分；函数名正确但参数错误给1.5分 |
| 保存去噪图像文件名 | `"_denoised.png"` | 1分 | 完全正确给1分 |
| 保存旋转图像文件名 | `"_rotated.png"` | 1分 | 完全正确给1分；写成`"_rotate.png"`给0.8分 |

---

## Task 2: CRNN模型训练 (30分)

### TODO 1: 数据集封装 - `__init__`方法 (4分)
**位置**: 第43-44行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `line.rstrip(......)` | `"\n"` | 1分 | `"\n"`或不填（默认去除空白）均给1分 |
| `self.samples.append((......, ......))` 第1个空 | `p` | 1.5分 | 正确给1.5分 |
| `self.samples.append((......, ......))` 第2个空 | `t` | 1.5分 | 正确给1.5分 |

---

### TODO 2: 数据集封装 - `__len__`方法 (2分)
**位置**: 第49行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `return ......` | `len(self.samples)` | 2分 | 完全正确给2分；只写`self.samples`不给分 |

---

### TODO 3: 数据集封装 - `__getitem__`方法 (3分)
**位置**: 第64行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `return ......, target, ......` 第1个空 | `img` | 1分 | 正确给1分 |
| `return ......, target, ......` 第2个空 | `len(target)` | 2分 | `len(target)`或`target.size(0)`均给2分 |

---

### TODO 4: 模型搭建 - 构建CNN卷积层 (8分)
**位置**: 第89-94行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| 第一层完整卷积 | `nn.Conv2d(1, 32, 3, 1, 1)` | 2分 | 完全正确给2分；通道数正确但其他参数错误给1.5分 |
| 第二层输出通道 | `64` | 1分 | 正确给1分 |
| 第三层输出通道 | `128` | 1分 | 正确给1分 |
| 第五层输出通道 | `256` | 1分 | 正确给1分 |
| `self.fc` 全连接层输入 | `128*2` | 3分 | `128*2`或`256`均给3分；理解双向LSTM输出是关键 |

**注意**: 如果考生整体架构正确但通道数不同，酌情给6-7分。

---

### TODO 5: 前向传播实现 (6分)
**位置**: 第103-107行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `x = x.......permute(0, 2, 1)` | `.squeeze(2).` | 3分 | 完全正确给3分；只有`squeeze(2)`给2分；维度处理错误给0-1分 |
| `x = self.......` (全连接) | `fc(x)` | 3分 | 正确给3分 |

---

### TODO 6: 训练函数实现 (5分)
**位置**: 第204行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `range(......, ......)` 第1个空 | `1` | 1.5分 | `1`或`0`均给1.5分 |
| `range(......, ......)` 第2个空 | `EPOCHS + 1` | 2分 | `EPOCHS + 1`或`EPOCHS`（如果第一个空是0）给2分；注意与第一个空的对应关系 |

**注意**: 如果写`range(1, EPOCHS)`会导致少训练一轮，给3分。

---

### TODO 7: 模型保存 (2分)
**位置**: 第224行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `torch......(model.state_dict(), SAVE_PATH)` | `.save` | 2分 | 完全正确给2分；缺少`.state_dict()`给1分 |

---

## Task 3: Tkinter GUI应用 (35分)

### TODO 1: 上传图片函数 - 打开文件对话框 (4分)
**位置**: 第48-50行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `filedialog.......(` | `askopenfilename` | 2分 | 正确给2分 |
| `filetypes=[("Image Files", ......)]` | `"*.jpg *.jpeg *.png"` | 2分 | 包含三种格式给2分；包含两种给1.5分；只有一种给1分 |

---

### TODO 2: 显示图片预览 (4分)
**位置**: 第58-60行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `image.thumbnail((......, ......))` 第1个空 | `400` | 1分 | 正确给1分 |
| `image.thumbnail((......, ......))` 第2个空 | `300` | 1分 | 正确给1分 |
| `photo = ......` | `ImageTk.PhotoImage(image)` | 2分 | 完全正确给2分；只写`PhotoImage(image)`给1分 |

---

### TODO 3: 图片识别函数 - 检查上传 (2分)
**位置**: 第71行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `......("Warning", ...)` | `messagebox.showwarning` | 2分 | 完全正确给2分；只写`showwarning`给1.5分 |

---

### TODO 4: 调用模型进行识别 (2分)
**位置**: 第76行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `preprocess_image(......)` | `current_image_path` | 2分 | 正确给2分 |

---

### TODO 5: 显示识别结果 (2分)
**位置**: 第87行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `result_label.config(......)` | `text=f"Result: {text}"` | 2分 | 正确给2分；只写变量名给1分；格式不同但能显示结果给1.5分 |

---

### TODO 6: 批量识别函数 - 选择文件夹 (2分)
**位置**: 第93行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `filedialog.......(title=...)` | `askdirectory` | 2分 | 正确给2分 |

---

### TODO 7: 遍历文件夹批量识别 (2分)
**位置**: 第101行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `if filename.lower()......:` | `.endswith(('.jpg', '.jpeg', '.png'))` | 2分 | 正确给2分；只检查一种格式给1分 |

---

### TODO 8: 保存识别结果为CSV (4分)
**位置**: 第117-118行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `columns=["filename", "size"]` | `["filename", "size"]` | 2分 | 两个列名都正确给2分；顺序错误但名称正确给1.5分；列名不同但合理给1.5分 |
| `df.......(output_csv, index=False)` | `.to_csv` | 2分 | 正确给2分 |

---

### TODO 9: 弹窗提示完成 (2分)
**位置**: 第122行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `......showinfo("Complete", ...)` | `messagebox.` | 2分 | `messagebox.showinfo`给2分；只写`showinfo`给1.5分 |

---

### TODO 10: 界面功能 - 创建图片显示区 (2分)
**位置**: 第145行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `img_label = ......(left_frame, ...)` | `Label` | 2分 | 正确给2分 |

---

### TODO 11: 界面功能 - 创建结果显示区 (2分)
**位置**: 第156行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `result_label = ......(right_frame, ...)` | `Label` | 2分 | 正确给2分 |

---

### TODO 12: 界面功能 - 创建上传按钮 (3分)
**位置**: 第161行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `upload_btn = ......(` | `Button` | 1分 | 正确给1分 |
| `text=......` | `"Upload Size Image"` | 1分 | 正确给1分 |
| `command=......` | `upload_image` | 1分 | 正确给1分 |

---

### TODO 13: 界面功能 - 创建识别按钮 (3分)
**位置**: 第166行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `recognize_btn = ......(` | `Button` | 1分 | 正确给1分 |
| `text=......` | `"Recognize Size"` | 1分 | 正确给1分 |
| `command=......` | `recognize_single` | 1分 | 正确给1分 |

---

### TODO 14: 界面功能 - 创建批量识别按钮 (3分)
**位置**: 第171行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `batch_btn = ......(` | `Button` | 1分 | 正确给1分 |
| `text=......` | `"Batch Recognize"` | 1分 | 正确给1分 |
| `command=......` | `batch_recognize` | 1分 | 正确给1分 |

---

## Task 4: 训练结果可视化 (15分)

### TODO 1: 导入Python库 (2分)
**位置**: 第6-7行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `import ...... as pd` | `pandas` | 1分 | 正确给1分 |
| `import ...... as plt` | `matplotlib.pyplot` | 1分 | 正确给1分；写`matplotlib`给0.5分 |

---

### TODO 2: 准确率计算 - 读取CSV (2分)
**位置**: 第15行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `log = pd.......` | `read_csv(LOG_CSV)` | 2分 | 完全正确给2分；只写函数名给1分 |

---

### TODO 3: 折线图绘制 (3分)
**位置**: 第20行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `plt.......` | `plot(log['epoch'], log['val_ap'])` | 3分 | 函数名和参数都正确给3分；使用`val_acc`替代`val_ap`给2.5分；函数名错误用`bar`给2分 |

**注意**: 职工组用的是`val_ap`（Average Precision）而不是`val_acc`。

---

### TODO 4: 设置图表标题 (2分)
**位置**: 第25行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `plt.......` | `title("Size Specification Recognition Accuracy")` | 2分 | 完全正确给2分；只写函数名`title`给1分 |

---

### TODO 5: 设置坐标轴标签 (4分)
**位置**: 第30-31行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `plt.......` (x轴) | `xlabel("Epoch")` | 2分 | 完全正确给2分；只写函数名给1分 |
| `plt.......` (y轴) | `ylabel("Accuracy")` | 2分 | 完全正确给2分；只写函数名给1分 |

---

### TODO 6: 结果展示 - 显示图形 (2分)
**位置**: 第45行

| 空位 | 标准答案 | 分值 | 评分标准 |
|------|---------|------|---------|
| `plt.......` | `show()` | 2分 | 正确给2分 |

---

## 评分注意事项

### 通用原则
1. **完全正确**: 代码语法正确、逻辑正确、能正常运行，给该空的全部分数
2. **部分正确**:
   - 代码逻辑正确但有小错误（如拼写错误、缺少括号）：给70%-90%分数
   - 使用了替代方案且功能等效：给80%-100%分数
   - 参数不完整但核心正确：给60%-80%分数
3. **基本正确**: 思路正确但实现有误：给40%-60%分数
4. **错误**: 完全错误或空白：0分

### 特殊情况处理
1. **导入库**: 如果库名拼写错误但意图明确（如`nmupy`），给50%分数
2. **函数调用**: 如果函数名正确但参数顺序错误，酌情给60%-80%分数
3. **字符串**: 单引号和双引号视为等效
4. **变量命名**: 如果使用了不同但合理的变量名，只要逻辑正确即给分
5. **格式化字符串**: f-string、.format()、%格式化、字符串拼接，只要结果正确都可给分
6. **图像处理参数**: 双边滤波、旋转角度等参数在合理范围内变化，只要能达到处理效果即可给分

### 职工组特别注意
1. **CRNN架构**: 职工组使用CRNN+CTC，比学生组的CNN更复杂，需要理解序列建模
2. **双向LSTM**: 输出维度是`hidden_size * 2`，这是重要考点
3. **评价指标**: 使用`val_ap`（Average Precision）而非`val_acc`
4. **图像尺寸**: 预处理是96×96，但模型输入是32×96（宽高比不同）

### 大模型评分指令
当使用大模型评分时，请提供：
1. 考生的完整代码
2. 每个TODO对应的行号范围
3. 要求大模型输出：
   - 每个空的得分
   - 扣分原因（如果有）
   - 总分
   - 建议改进（可选）

### 评分容错建议
对于以下情况应该给予部分分数：
- **创新解法**: 如果考生使用了不同但合理的实现方式，应根据功能是否实现给分
- **性能优化**: 如果考生使用了更高效的方法（如使用`np.histogram`替代`plt.hist`），应给满分
- **防御性编程**: 如果考生添加了额外的错误处理，不应扣分
- **代码风格**: 只要功能正确，代码风格（如空格、换行）不影响评分
